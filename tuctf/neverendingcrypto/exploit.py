def caesar(plaintext, shift):
    alphabet = string.ascii_lowercase
    shifted_alphabet = alphabet[shift:] + alphabet[:shift]
    table = string.maketrans(alphabet, shifted_alphabet)
    return plaintext.translate(table)

from pwn import *;

r = remote("neverending.tuctf.com", 12345)
i=0
while(True):
	print "ITERATION: %d"%i;
	print r.readuntil("Give me some text:");

	r.sendline("a");

	result = r.readline();
	result = result.split(" encrypted is ");
	print result[0] + "\t"+ result[1];

	print "ORD of 0: " + str(ord(result[0][0]))
	print "ORD of 1: " + str(ord(result[1][0]))
	difference = (ord(result[1][0]))-(ord(result[0][0]));

	difference = difference * -1;

	print "Difference: " + str(difference);

	encry = r.readline();
	print encry;
	unencry = "";
	encry = encry.split("What is ")[1].split(" decrypted?")[0];

	r.readuntil(":");

	for character in encry:
		print "Current character: " + character;
		x = ord(character);
		if((x+difference) < 32):
			print("TRACK 1");
			print("X: " + str(x));
			print("Diff: " + str(difference));
			difference = difference * -1;
			print("Diff: " + str(difference));
			print("127-(difference-(x-32)): " + str(127-(difference-(x-32))))
			unencry = unencry + chr(127-(difference-(x-32)))
			difference = difference * -1
		elif(x+difference >= 127):
			unencry = unencry + chr(32 + (x + difference) % (127))
		else:
			unencry = unencry + chr((x + difference))
		print "\tFinished Character: " + unencry.strip()[-1];
	print unencry;

	r.sendline(unencry);
	if(i==49):
		break;
	result = r.readline();
	print result;
	#print "RESULT: |" + result + "|";
	if(result == "No... I am leaving.\n"):
		print("LEAVING!");
		break;
	elif(result != "Correct!\n"):
		print("INCOR ");
		print r.readline();

	i=i+1;

r.interactive();